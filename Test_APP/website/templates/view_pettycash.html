{% extends "base.html" %}
{% block title %}Revisi贸n de Petty Cash - {{ petty.petty_num }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="mb-4">
      <div class="position-relative" style="height: 56px;">
        <!-- Back Button (left) -->
        <a href="#"
          onclick="history.go(-1)"
          class="btn btn-outline-dark position-absolute"
          style="top: 50%; left: 0; transform: translateY(-50%); margin-left: 8px;">
          &#8592; 
        </a>
        <!-- Centered Title -->
        <h1 class="mb-0 position-absolute w-100 text-center"
            style="pointer-events: none;" >
            Petty Cash #{{ petty.petty_num }}
        </h1>
      </div>
    </div>
 
  <p><strong>Usuario:</strong> {{ petty.user.first_name }} {{ petty.user.last_name }}</p>
  <p><strong>Fecha de creaci贸n:</strong> {{ petty.date.strftime('%Y-%m-%d') }}</p>
  <p><strong>Estado actual:</strong> <span class="badge bg-info text-dark">{{ petty.status }}</span></p>

  <form method="POST" enctype="multipart/form-data">
    <table class="table table-bordered mt-3">
      <thead class="table-dark">
        <tr>
          <th>Fecha</th>
          <th>Pagado a</th>
          <th>Materiales</th>
          <th>Descripci贸n</th>
          <th>$$</th>
          <th>Proyecto</th>
          <th>Recibos</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <!-- Hidden input to preserve item ID -->
          <input type="hidden" name="item_id[]" value="{{ item.id }}">
          <td>{{ item.date.strftime('%Y-%m-%d') }}</td>
          <td>{{ item.paid_to }}</td>
          <td>{{ item.material }}</td>
          <td>{{ item.description }}</td>
          <td>
            {{ item.quantity }}
          </td>
          <td>
            {% for project in all_projects %}
              {% if item.project_id == project.id %}
                {{ project.project }} - {{ project.jobnumber }}
              {% endif %}
            {% endfor %}
          </td>
          <td>
            {% for doc in item.docs %}
              <div class="uploaded-doc d-flex align-items-center mb-2">
                <a href="{{ url_for('static', filename='pettycash/' ~ doc.filename) }}" target="_blank" class="me-2">{{ doc.filename }}</a>
                </div>
            {% endfor %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="d-flex justify-content-between align-items-center mt-4">
      <div>
        <h5>Total: ${{ '%.2f'|format(petty.total_amount) }}</h5>
      </div>
      <div class="form-group">
        <label for="review_notes">Notas de revisi贸n</label>
        <textarea class="form-control" rows="4" disabled>{{ petty.review_notes or '' }}</textarea>
      </div>
    <p><strong>Procesado por:</strong> {{ petty.processed_by.first_name}} {{petty.processed_by.last_name if petty.processed_by else '' }}</p>
    <p><strong>Fecha de procesamiento:</strong> {{ petty.processed_date.strftime('%Y-%m-%d %H:%M') if petty.processed_date else '' }}</p>
      <div>
        
        <a href="{{ url_for('views.generate_petty_pdf', petty_id=petty.id) }}"
            target="_blank"
            class="btn btn-primary">
            Imprimir
        </a>
      </div>
    </div>
  </form>
</div>

<br />
{% endblock %}
