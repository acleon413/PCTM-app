{% extends "base.html"%} {% block title %}PCTM Construction{% endblock %}

{% block content %}
<br />

<h1 align="center">Bienvenidos, {{ user.first_name }} {{user.last_name}}!</h1>

<br />
<br />



<br/>
<form method="get" class="form-inline mb-3">
  <label for="project_filter" class="mr-2">Filtrar por Proyecto:</label>
  <select name="project_id" id="project_filter" class="form-control mr-2">
    <option value="">Todos</option>
    {% for project in all_projects %}
      <option value="{{ project.id }}" 
        {% if request.args.get('project_id') == project.id|string %}selected{% endif %}>
        {{ project.project }}
      </option>
    {% endfor %}
  </select>
  <button type="submit" class="btn btn-primary">Filtrar</button>
</form>
  <h2>Petty Cash Sometidos para Aprobaci√≥n</h2>
  
  <table class="table table-stripped">
      <thead>
          <tr>
            <th>Nombre</th>
            <th>Numero de Petty</th>
            <th>Fecha</th>
            <th>Proyecto</th>
            <th>Total</th>
            <th>Estatus</th>
            <th>Acciones</th>  <!-- NEW column -->

          </tr>
      </thead>
      <tbody>
          {% for i in submitted_pettys %}
          <tr>
            <td>{{ i.user.first_name}} {{ i.user.last_name }}</td>
            <td>{{ i.petty_num}}</td>
            <td>{{ i.date.strftime('%Y-%m-%d') }}</td>
            <td>{{ i.pettycashitems[0].project.project if i.pettycashitems else '' }}</td>
            <td>${{ i.total_amount }}</td>
            <td>{{ i.status }}</td>
            <td>
                <a href="{{ url_for('views.review_pettycash', petty_id=i.id) }}" class="btn btn-sm btn-primary">
                  Revisar
                </a>
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>

  <h2>Petty Cash Procesados</h2>
  
  <table class="table table-stripped">
      <thead>
          <tr>
            <th>Nombre</th>
            <th>Numero de Petty</th>
            <th>Fecha</th>
            <th>Proyecto</th>
            <th>Total</th>
            <th>Estatus</th>
            <th>Acciones</th>  <!-- NEW column -->

          </tr>
      </thead>
      <tbody>
          {% for i in processed_pettys %}
          <tr>
            <td>{{ i.user.first_name}} {{ i.user.last_name }}</td>
            <td>{{ i.petty_num}}</td>
            <td>{{ i.date.strftime('%Y-%m-%d') }}</td>
            <td>{{ i.pettycashitems[0].project.project if i.pettycashitems else '' }}</td>
            <td>${{ i.total_amount }}</td>
            <td>{{ i.status }}</td>
            <td>
                <a href="{{ url_for('views.view_pettycash', petty_id=i.id) }}" class="btn btn-sm btn-primary">
                  Ver
                </a>
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>

{% endblock %}